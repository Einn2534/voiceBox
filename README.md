# voiceBox プロジェクト概要

## 全体像
voiceBox は、Kivy を用いた GUI アプリケーションと、NumPy ベースの音声合成 DSP モジュールで構成された、小規模な日本語 CV（子音+母音）合成ツールです。`Main.py` がアプリの UI やユーザー操作を司り、`Dsp.py` が波形生成ロジックを提供します。

```
voiceBox/
├── Main.py      # Kivy アプリケーション（UI とユーザー操作）
├── Dsp.py       # 音声合成ロジック（フォルマント、子音、I/O など）
└── __pycache__  # Python 実行時に生成されるキャッシュ（通常は無視）
```

## 重要ポイント
### 1. Kivy UI (`Main.py`)
- `Root` クラスが画面全体のレイアウトを構築します。スライダーやボタンが束ねられており、それぞれが音声合成処理をトリガーします。
- 音声再生は `SoundLoader` を通じて行われ、バックグラウンド処理には Python の `threading` を用いています。
- UI の変更時は、`Clock.schedule_once` でメインスレッドに戻すという Kivy の定石に従っている点に注意してください。

### 2. DSP モジュール (`Dsp.py`)
- NumPy を使った純粋な信号処理で構築されており、ニューラルネットワークは使用していません。
- 主な役割は以下の通りです。
  - `_glottal_source` などのソース生成関数
  - `_bandpass_biquad_coeff` 等のフィルタ設計関数
  - `synth_vowel`, `synth_cv`, `synth_phrase_to_wav` といった高レベルの合成 API
  - `write_wav` による 16bit PCM WAV 出力
- `VOWEL_TABLE` で母音ごとのフォルマントや帯域幅が定義されています。追加・調整時はこのテーブルを更新します。
- 子音は `/s/`, `/sh/`, `/h/`, `/f/`, `/t/`, `/k/`, `/ch/`, `/ts/`, `/n/`, `/m/`, `/y/`, `/w/`, `/r/` を実装済みで、摩擦音・破裂音・鼻音・半母音の各モジュールを経由して合成されます。

### 3. サンプリング周波数と正規化
- 全体で `FS = 22050` Hz を前提としており、`Main.py`・`Dsp.py` 双方で共有しています。
- `_normalize_peak` でピークが 0.9 付近になるようスケーリングしています。追加処理でも極力この方針を踏襲してください。

## 次に学ぶと良いトピック
1. **Kivy のレイアウト／ウィジェット**
   - 既存の `BoxLayout`, `Button`, `Slider`, `Label` の使い方を理解すると、UI 改修が容易になります。
   - `Clock.schedule_once` の使用理由（UI スレッドに戻す）を押さえましょう。
2. **基本的な DSP（デジタル信号処理）**
   - フォルマント合成やバンドパスフィルタの基礎。
   - Jitter/Shimmer のような揺らぎ付加ロジック。
3. **音声ファイル I/O**
   - `wave` モジュールでの 16bit PCM 書き出し。
   - 出力ピークやフェード処理の考え方。
4. **コード拡張の方向性**
   - 新しい子音を追加する場合は `_gen_band_noise` や `_crossfade` の再利用を検討。
   - UI に録音／保存ボタンを増やす際は、スレッド管理と状態表示の更新方法に注意。

## 開発時のヒント
- Python 3.10 以降 + Kivy + NumPy を想定しています。ローカル環境構築時はこれらの依存関係を準備してください。
- 変更を加えたら `python Main.py` で GUI を立ち上げて動作確認するのが最も手っ取り早いです。画面上には 50 音テーブル（あ行〜わ行＋ん）が並び、各ボタンから該当する CV が即座に合成されます。
- DSP ロジックを単体テストしたい場合は、`Dsp.py` の関数を直接インポートして NumPy 配列のプロパティ（長さ・ピーク値など）を検証すると良いでしょう。

## 今後のロードマップ例
- フォルマントテーブルを年齢・性別別に追加し、UI から選択できるようにする。
- 子音レパートリーを増やし、CV 合成をより多彩にする。
- Kivy の `SoundLoader` から別ライブラリへの移行や、リアルタイム再生の最適化。

上記を参考に、まずは `Main.py` と `Dsp.py` をじっくり読み込み、既存のパラメータや処理フローを理解するところから始めてください。
